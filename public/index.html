<!DOCTYPE html>
<html lang="en" dir="ltr" ng-app="MyApp">
    <head>
        <meta charset="utf-8">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.8/angular.min.js" charset="utf-8"></script>
		<script src="app.js" charset="utf-8"></script>
		<link rel="stylesheet" href="/css/normalize.css">
		<link rel="stylesheet" href="/css/skeleton.css">
		<link rel="stylesheet" href="/css/main.css">
		<title>Trusty Townies</title>
    </head>
    <body>
		<div class="container" ng-controller="AppController as ctrl">
			<nav>
        	<div ng-hide="ctrl.loggedInUsername">
	            <!-- LOGIN -->
	            <h3 ng-click="login={'display':'block'}">LOGIN/SIGN UP</h3>
	            <!-- login modal -->
					<div id="loginModal" class="modal" ng-style="login">
	                    <div class="modal-content">
							<div class="modal-body">
								<form ng-submit="ctrl.logIn()">
				                    <input type="text" ng-model="ctrl.username" placeholder="username">
				                    <input type="password" ng-model="ctrl.password" placeholder="password">
				                    <input type="submit" value="Log In" ng-click="login={}">
				                </form>
								<h2>OR</h2>
								<!-- CREATE USER -->
								<form ng-submit="ctrl.createUser()">
					                <input type="text" ng-model="ctrl.newUsername" placeholder="username">
					                <input type="text" ng-model="ctrl.newPassword" placeholder="password">
					                <!-- <input type="text" ng-model="ctrl.confirmPassword" placeholder="confirm password"> -->
					                <input type="submit" value="Create User"/>
					            </form>
							</div>
							<div class="modal-footer">
							<button ng-click="login={}" class="close">X</button>
							</div>
						</div>
	                </div>
				</div>
	            <!-- LOGOUT -->
				<div ng-show="ctrl.loggedInUsername">
					<form ng-submit="ctrl.logOut()">
		                <input type="submit" value="Log Out">
		            </form>
				</div>
	        </nav>
			<h1>Trusty Townies</h1>
	    	<div id="main-townie-display" ng-show="ctrl.loggedInUsername">
          <div ng-hide="ctrl.isCompanySelected">
				<h4>Know a Townie you Trust?<br>
			   	 <span>Add them here:</span>
			   	 </h4>
				<form ng-submit="ctrl.createTownie()">
	  				<input type="text" ng-model="ctrl.name" placeholder="Company Name"/>
					<input type="text" ng-model="ctrl.streetAddress" placeholder="Street Address"/>
					<input type="text" ng-model="ctrl.city" placeholder="City"/>
					<input type="text" ng-model="ctrl.state" placeholder="State"/>
					<input type="text" ng-model="ctrl.zipcode" placeholder="Zipcode"/>
					<textarea ng-model="ctrl.description" placeholder="description"></textarea>
					<input type="submit" value="Create New Townie"/>
	  			</form>
				<div>
				    Search Company Name:<input ng-model="searchBox.name" type="text" placeholder="Enter a Name">
				    Search By City:<input ng-model="searchBox.city" type="text" placeholder="Enter a City">
					Search By State:
					<select
						ng-options= "state for state in ctrl.allStatesList()"
						ng-model="searchBox.state">
						<option value=""> Choose State </option>
					</select>
					<!--
					<select
						ng-options= "company as company.state for company in ctrl.companies"
						ng-model="searchBox.state">
						<option value=""> Choose State </option>
					</select>
					Search By State:<input ng-model="searchBox.state" type="text" placeholder="Enter a State"><br /><br /> -->
				    <table>
				        <tr>
							<th>Company Name</th>
							<th>City</th>
							<th>State</th>
							<th>Description</th>
						</tr>
				        <tr
							class="townie-table-row"
							ng-repeat="companies in ctrl.companies | filter : searchBox"
							ng-click="ctrl.showTownie(companies)">
				            <td>{{companies.name}}</td>
				            <td>{{companies.city}}</td>
				            <td>{{companies.state}}</td>
				            <td>{{companies.description}}</td>
				        </tr>
				    </table>
            </div>
				</div>
				<div ng-show="ctrl.isCompanySelected">
					<form ng-submit="ctrl.editTownie(ctrl.companyToShow)">
		  				<input type="text" ng-model="ctrl.editedName" placeholder="Company Name" value="{{ctrl.companyToShow.name}}"/>
						<input type="text" ng-model="ctrl.editedStreetAddress" placeholder="Street Address" value="{{ctrl.companyToShow.streetAddress}}"/>
						<input type="text" ng-model="ctrl.editedCity" placeholder="City" value="{{ctrl.companyToShow.city}}"/>
						<input type="text" ng-model="ctrl.editedState" placeholder="State" value="{{ctrl.companyToShow.state}}"/>
						<input type="text" ng-model="ctrl.editedZipcode" placeholder="Zipcode" value="{{ctrl.companyToShow.zipcode}}"/>
						<textarea ng-model="ctrl.editedDescription" placeholder="description" value="{{ctrl.companyToShow.description}}"></textarea>
						<input type="submit" value="Save Changes" ng-show="ctrl.isEditEnabled"/>
		  			</form>
            		<button ng-hide="ctrl.isEditEnabled" ng-click="ctrl.toggleEditTownieForm()">Edit</button>
					<div id="map-search-panel">
						<b>Your Address:</b>
						<input type="text" id="start">
						<input type="hidden" id="end" value="{{ctrl.selectedCompanyAddress}}">
						<button id="directions-btn" type="button" name="button">Get Directions</button>
					</div>
					<div id="map"></div>
          <form>
            <button id="back-btn" type="button" ng-click="ctrl.back()">Back to List</button>
              <div ng-hide="isCompanySelected"></div>

              </div>
          </form>
				</div>
			</div>
		</div>
	<script>
		function initMap() {
			const directionsService = new google.maps.DirectionsService();
			const directionsRenderer = new google.maps.DirectionsRenderer();
			const map = new google.maps.Map(document.getElementById('map'), {
				zoom: 7,
				center: {lat: 41.85, lng: -87.65}
			});
			directionsRenderer.setMap(map);

			const onChangeHandler = function() {
				calculateAndDisplayRoute(directionsService, directionsRenderer);
			};
			document.getElementById('directions-btn').addEventListener('click', onChangeHandler);
			}
		function calculateAndDisplayRoute(directionsService, directionsRenderer) {
			directionsService.route(
				{
					origin: {query: document.getElementById('start').value},
					destination: {query: document.getElementById('end').value},
					travelMode: 'DRIVING'
				},
				function(response, status) {
					if (status === 'OK') {
						directionsRenderer.setDirections(response);
					} else {
						window.alert('Directions request failed due to ' + status);
					}
				});
		}
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-99aWDom_qs9Pfq5tS3ay3nBIa4kHyew&callback=initMap" async defer></script>
	</body>
</html>
